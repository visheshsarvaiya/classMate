"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.stopTracer = exports.initTracer = void 0;
const core_utils_1 = require("../../core-utils");
const path_1 = __importDefault(require("path"));
const opentracing_1 = require("opentracing");
let tracerProvider;
/**
 * tracerFile should be a js file that exports two functions.
 *
 * `create` - Create and return an open-tracing compatible tracer. See
 * https://github.com/opentracing/opentracing-javascript/blob/master/src/tracer.ts
 *
 * `stop` - Run any tracer cleanup required before the node.js process
 * exits
 */
const initTracer = async (tracerFile) => {
    let tracer;
    if (tracerFile) {
        process.env.GATSBY_OPEN_TRACING_CONFIG_FILE = tracerFile;
        const resolvedPath = (0, core_utils_1.slash)(path_1.default.resolve(tracerFile));
        tracerProvider = require(resolvedPath);
        tracer = await tracerProvider.create();
    }
    else {
        tracer = new opentracing_1.Tracer(); // Noop
    }
    (0, opentracing_1.initGlobalTracer)(tracer);
    return tracer;
};
exports.initTracer = initTracer;
const stopTracer = async () => {
    if (tracerProvider?.stop) {
        await tracerProvider.stop();
    }
};
exports.stopTracer = stopTracer;
//# sourceMappingURL=index.js.map